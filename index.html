<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <title>KUIZ MPU2071 - IPG KAMPUS DARULAMAN</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;700&family=JetBrains+Mono&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --primary: #FFB800; --bg: #0d0d0d; --card: #161616; }
        body { background: var(--bg); color: #e0e0e0; font-family: 'Outfit', sans-serif; margin: 0; }
        .container { max-width: 800px; margin: 2rem auto; padding: 20px; }
        .card { background: var(--card); padding: 30px; border-radius: 8px; border: 1px solid #222; margin-bottom: 20px; }
        input, textarea { width: 100%; background: #000; border: 1px solid #333; color: #fff; padding: 12px; margin: 10px 0; border-radius: 4px; box-sizing: border-box; }
        .btn { background: var(--primary); color: #000; padding: 15px; border: none; width: 100%; font-weight: bold; cursor: pointer; border-radius: 4px; }
        .q-box { border-left: 4px solid var(--primary); padding-left: 15px; margin-bottom: 20px; }
        .mark-label { color: var(--primary); font-size: 0.8rem; font-weight: bold; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <div id="login-screen" class="card">
        <h2 style="color: var(--primary)">PENGURUSAN KOKURIKULUM (MPU2071)</h2>
        <p>Sila masukkan No. Kad Pengenalan untuk memulakan kuiz.</p>
        <input type="text" id="ic-field" placeholder="Contoh: 010114-03-0523">
        <button class="btn" onclick="masukSistem()">MULA UJIAN</button>
    </div>

    <div id="exam-screen" class="hidden">
        <div class="card">
            <div id="timer" style="text-align:right; color:var(--primary); font-family: 'JetBrains Mono'">30:00</div>
            
            <div class="q-box">
                <p>1. Berikan 5 matlamat kokurikulum yang ingin dicapai selaras dengan Falsafah Pendidikan Negara.</p>
                <span class="mark-label">(5 Markah)</span>
                <textarea id="q1" rows="4"></textarea>
            </div>

            <div class="q-box">
                <p>2. Binakan satu struktur organisasi Persatuan Sejarah di sekolah anda.</p>
                <span class="mark-label">(4 Markah)</span>
                <textarea id="q2" rows="4"></textarea>
            </div>

            <div class="q-box">
                <p>3. Nyatakan kelompok-kelompok gerak kerja kokurikulum sekolah dan berikan contoh setiap kategori.</p>
                <span class="mark-label">(6 Markah)</span>
                <textarea id="q3" rows="4"></textarea>
            </div>

            <div class="q-box">
                <p>4. Nyatakan 5 tugas seorang Bendahari dalam Pasukan Kadet Remaja Sekolah.</p>
                <span class="mark-label">(5 Markah)</span>
                <textarea id="q4" rows="4"></textarea>
            </div>

            <button class="btn" onclick="hantarSemua()">HANTAR JAWAPAN & JANA PDF</button>
        </div>
    </div>

    <div id="success-screen" class="hidden card" style="text-align: center;">
        <h2 style="color: #00ff88">JAWAPAN BERJAYA DIHANTAR</h2>
        <p>Sila simpan fail PDF yang telah dimuat turun.</p>
    </div>
</div>

<script>
    const SCRIPT_URL = "GANTIKAN_DENGAN_URL_WEB_APP_BARU_ANDA";
    let dataPelajar = {};
    let timeLeft = 1800;

    async function masukSistem() {
        const ic = document.getElementById('ic-field').value;
        const res = await fetch(`${SCRIPT_URL}?action=login&ic=${ic}`);
        const json = await res.json();

        if(json.result === "success") {
            dataPelajar = json.data;
            dataPelajar.ic = ic;
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('exam-screen').classList.remove('hidden');
            startTimer();
        } else {
            alert("Ralat: IC tidak dijumpai atau sudah menjawab.");
        }
    }

    function startTimer() {
        setInterval(() => {
            timeLeft--;
            const m = Math.floor(timeLeft/60);
            const s = timeLeft%60;
            document.getElementById('timer').innerText = `${m}:${s < 10 ? '0' : ''}${s}`;
            if(timeLeft <= 0) hantarSemua();
        }, 1000);
    }

    async function hantarSemua() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        doc.setFontSize(14);
        doc.text("SKRIP JAWAPAN KUIZ MPU2071", 105, 20, {align: 'center'});
        doc.setFontSize(10);
        doc.text(`Nama: ${dataPelajar.nama}`, 20, 40);
        doc.text(`Matrik: ${dataPelajar.no_matrik}`, 20, 45);
        doc.text(`Pensyarah: ${dataPelajar.nama_pensyarah}`, 20, 50);
        
        const q1 = document.getElementById('q1').value;
        const q2 = document.getElementById('q2').value;
        const q3 = document.getElementById('q3').value;
        const q4 = document.getElementById('q4').value;

        doc.text("Jawapan 1:", 20, 60); doc.text(doc.splitTextToSize(q1, 170), 20, 65);
        doc.text("Jawapan 2:", 20, 100); doc.text(doc.splitTextToSize(q2, 170), 20, 105);
        doc.text("Jawapan 3:", 20, 140); doc.text(doc.splitTextToSize(q3, 170), 20, 145);
        doc.text("Jawapan 4:", 20, 180); doc.text(doc.splitTextToSize(q4, 170), 20, 185);

        doc.save(`MPU2071_${dataPelajar.no_matrik}.pdf`);

        await fetch(SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors',
            body: JSON.stringify({action: 'submit', ic: dataPelajar.ic})
        });

        document.getElementById('exam-screen').classList.add('hidden');
        document.getElementById('success-screen').classList.remove('hidden');
    }
</script>
</body>
</html>
